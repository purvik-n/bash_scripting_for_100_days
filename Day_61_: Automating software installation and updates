#!/bin/bash

# --- Configuration ---
PACKAGES_TO_INSTALL=("git" "vim" "htop")

# --- Function to Check Package Manager ---
get_pkg_manager() {
    if command -v apt &> /dev/null; then
        echo "apt"
    elif command -v dnf &> /dev/null; then
        echo "dnf"
    elif command-v yum &> /dev/null; then
        echo "yum"
    else
        echo "unknown"
    fi
}

PKG_MANAGER=$(get_pkg_manager)

# --- Function to Run Updates ---
system_update() {
    echo "--- Running System Updates ---"
    if [ "$PKG_MANAGER" == "apt" ]; then
        sudo apt update && sudo apt upgrade -y
        sudo apt autoremove -y
    elif [ "$PKG_MANAGER" == "yum" ] || [ "$PKG_MANAGER" == "dnf" ]; then
        sudo $PKG_MANAGER update -y
        sudo $PKG_MANAGER autoremove -y  # DNF specific cleanup, use 'yum clean all' for older YUM
    else
        echo "Error: Unsupported package manager."
        exit 1
    fi
    echo "--- System Update Complete ---"
}

# --- Function to Install Packages ---
install_packages() {
    echo "--- Installing Required Packages: ${PACKAGES_TO_INSTALL[@]} ---"
    
    if [ "$PKG_MANAGER" == "apt" ]; then
        sudo apt install -y "${PACKAGES_TO_INSTALL[@]}"
    elif [ "$PKG_MANAGER" == "yum" ] || [ "$PKG_MANAGER" == "dnf" ]; then
        sudo $PKG_MANAGER install -y "${PACKAGES_TO_INSTALL[@]}"
    else
        # Error handled in system_update, but good to check again
        echo "Error: Cannot install packages. Unknown Package Manager."
        exit 1
    fi

    if [ $? -eq 0 ]; then
        echo "SUCCESS: All packages installed successfully."
    else
        echo "FAILURE: One or more packages failed to install."
    fi
}

# --- Main Execution ---
system_update
install_packages

echo "Installation script finished."
